#+title: vm-runtime

define all functions that are necessary to provide runtime functions for the
byte code vm.

links: https://github.com/barryw/c64lib

* TODO
- [X] provide functions for benchmarking
  - [X] use timers to record time spent
  - [X] provide output function for time spent
  - [X] provide function for waiting keypress
  - [X] provide function for basic warmstart afterwards
- [ ] do some scroll / text output benchmarks
  - [ ] fill screen with 0..9, and alternating color, then scroll (and record timing), then clear screen, then output time spent
    - left 40 times
    - right 40 times
    - down 24 times
    - up 24 times
  - [ ] run benchmark on c64
- [ ] implement bc code/runtime functions to
  - [ ] write strings on screen
  - [ ] scroll screen
  - [ ] colorize characters/regions
  - [ ] allow for highlighting regions (e.g. inverse and set color?)
- [ ] implement data structure of text buffers
- [ ] implement display of buffers
- [ ] implement large arrays (larger strings)
- [ ] make sure that naming is corrected
      EVLSTK_TAIL for all but RT
      CELL :: 2 byte tagged ptr or atomic
      SLOT :: profile driven number of bytes on a page (refcnt x slot-type x payload)
      PAGE :: 256 bytes
      PAGE-TYPE :: m1-page | cell-stack | call-frame-stack | ...
      ...
- [ ] define vm-runtime-errors.rkt that prints out error codes (e.g. BDCD, outputs integer in A/X)
      1 :: out of memory error
- [ ] cleanup
  minimize require
  use ~define-vm-function~ where possible
  use ~regression-test~
  ensure good code coverage
  ensure export of complete code in one variable
  ensure estimated-code-length check
  ensure order of ~provide~, documentation, ~require~
  - [ ] vm-native-array.rkt
  - [ ] vm-memory-map.rkt
  - [ ] vm-memory-manager.rkt
  - [ ] vm-m1-slots.rkt
  - [ ] vm-lists.rkt
  - [ ] vm-cell-stack.rkt
  - [ ] vm-cell-array.rkt
  - [ ] vm-call-frame.rkt
  - [ ] vm-screen.rkt
* ...
#+begin_src emacs-lisp
  ;; Local Variables:
  ;; org-pretty-entities-include-sub-superscripts: nil   ;; make sure _ is not interpreted as subscript
  ;; fill-column: 100                                    ;; fill paragraphs with 100 char width
  ;; End:
  #+end_src
